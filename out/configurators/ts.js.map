{"version":3,"file":"ts.js","sourceRoot":"","sources":["../../src/configurators/ts.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA,AAAO,AAAK,AAAI,AAAM,AAAM;;AAE5B,AAAO,AAAE,AAAoB,AAAE,AAAM,AAAS,AAE9C,AAAM;;;;;;;;;;;;;2CAAC,AAAK,WAA8B,AAAiC;AACzE,UAAM,AAAY,eAAG,AAAY,aAAC,AAAgB,iBAAC,AAAgC,AAAC,qCAAI,AAAY,aAAC,AAAgB,iBAAC,AAAqB,AAAC;;AAC5I,QAAI,AAAC,EAAC,AAAY,gBAAI,AAAY,aAAC,AAAgB,iBAAC,AAAW,AAAC,AAAC,eAAE;AACjE,AAAM;AACP,MAED,AAAe;;;AACf,AAAY,iBAAC,AAAU,WAAC,AAAM,OAAC,AAAC,GAAE,AAAC,GAAE,AAAK,OAAE,AAAM,AAAC;AAEnD,UAAM,AAAe,kBAAG,AAAY,aAAC,AAAM,AAAI,UAAC,AAAY,gBAAI,CAAC,AAAY,aAAC,AAAY,AAAC;AAE3F,UAAM,AAAY,eAAG,MAAM,AAAoB,kCAAC,CAAC,AAAI,KAAC,AAAI,KAAC,AAAY,aAAC,AAAS,WAAE,AAAe,AAAC,kBAAE,AAAI,KAAC,AAAI,KAAC,AAAY,aAAC,AAAU,YAAE,AAAe,AAAC,AAAC,mBAAE,AAAI,AAAC,OAChK,AAA2D;;AAC3D,QAAI,AAAY,gBAAI,AAAI,MAAE;AACxB,YAAM,IAAI,AAAK,AAAC,6CAAuC,AAAY,aAAC,AAAU,UAAmF,AAAC;AACnK;;AAED,QAAI,AAAY,aAAC,AAAK,MAAC,AAAO,SAAE;AAC9B,AAAY,mBAAC,AAAK,AAAC,eAAS,AAAY,YAAE,AAAC;AAC5C,MAED,AAAsE;;;AACtE,QAAI,AAAe,mBAAI,CAAC,AAAY,aAAC,AAAM,QAAE;AAC3C,YAAM,AAA0B,6BAAG,AAAO,QAAC,AAAgC,AAAC;;AAC5E,AAAY,mBAAC,AAAO,QAAC,AAAI,SAAK,AAA0B;AACtD,AAAQ,kBAAE,AAAY;AACtB,AAAM,gBAAE,AAAY,aAAC,AAAG,IAAC,AAAmB;AAC1C,AAAI,gBAAE,AAAG,AAAE,OACT,AAAS,AACX;AAAC;AAED,AAAI,gBAAE,AAAO,QAAC,AAAI,KAAC,AAAI,KAAC,AAAO,AAAC;AAChC,AAAK,iBAAE,AAAO,QAAC,AAAK,MAAC,AAAI,KAAC,AAAO,AAAC,AACnC,AACF,AAAC,AAAC;AAR+C;AAFO,OAA/B;AAW3B;;AAED,UAAM,AAAe;AACnB,AAAiD;AACjD,AAAwE;AACxE,AAAa,qBAAE,AAAe;AAC9B,AAAgB,wBAAE,CAAC,AAAQ,AAAC;AAC5B,AAAU,kBAAE,AAAY,AACzB;AAN4B;;AAQ7B,QAAI,AAAY,aAAC,AAAK,MAAC,AAAO,SAAE;AAC9B,AAAY,mBAAC,AAAK,AAAC,4BAAsB,AAAI,KAAC,AAAS,UAAC,AAAe,iBAAE,AAAI,MAAE,AAAC,AAAC,EAAE,AAAC;AACrF;;AAED,AAAY,iBAAC,AAAK,MAAC,AAAI;AACrB,AAAI,YAAE,AAAS;AACf,AAAO,eAAE,AAAc;AACvB,AAAG;AAEC,AAAM,gBAAE,AAAW;AACnB,AAAO,iBAAE,AAAe,AACzB,AACF,AACF,AAAC,AACJ;AANM,OADG;AAHiB;AAUzB","sourcesContent":["import * as path from \"path\"\nimport { WebpackConfigurator } from \"../main\"\nimport { getFirstExistingFile } from \"../util\"\n\nexport async function configureTypescript(configurator: WebpackConfigurator) {\n  const hasTsChecker = configurator.hasDevDependency(\"fork-ts-checker-webpack-plugin\") || configurator.hasDevDependency(\"electron-webpack-ts\")\n  if (!(hasTsChecker || configurator.hasDevDependency(\"ts-loader\"))) {\n    return\n  }\n\n  // add after js\n  configurator.extensions.splice(1, 0, \".ts\", \".tsx\")\n\n  const isTranspileOnly = configurator.isTest || (hasTsChecker && !configurator.isProduction)\n\n  const tsConfigFile = await getFirstExistingFile([path.join(configurator.sourceDir, \"tsconfig.json\"), path.join(configurator.projectDir, \"tsconfig.json\")], null)\n  // check to produce clear error message if no tsconfig.json\n  if (tsConfigFile == null) {\n    throw new Error(`Please create tsconfig.json in the \"${configurator.projectDir}\":\\n\\n{\\n  \"extends\": \"./node_modules/electron-webpack/tsconfig-base.json\"\\n}\\n\\n`)\n  }\n\n  if (configurator.debug.enabled) {\n    configurator.debug(`Using ${tsConfigFile}`)\n  }\n\n  // no sense to use fork-ts-checker-webpack-plugin for production build\n  if (isTranspileOnly && !configurator.isTest) {\n    const ForkTsCheckerWebpackPlugin = require(\"fork-ts-checker-webpack-plugin\")\n    configurator.plugins.push(new ForkTsCheckerWebpackPlugin({\n      tsconfig: tsConfigFile,\n      logger: configurator.env.forkTsCheckerLogger || {\n        info: () => {\n          // ignore\n        },\n\n        warn: console.warn.bind(console),\n        error: console.error.bind(console),\n      }\n    }))\n  }\n\n  const tsLoaderOptions: any = {\n    // use transpileOnly mode to speed-up compilation\n    // in the test mode also, because checked during dev or production build\n    transpileOnly: isTranspileOnly,\n    appendTsSuffixTo: [/\\.vue$/],\n    configFile: tsConfigFile,\n  }\n\n  if (configurator.debug.enabled) {\n    configurator.debug(`ts-loader options: ${JSON.stringify(tsLoaderOptions, null, 2)}`)\n  }\n\n  configurator.rules.push({\n    test: /\\.tsx?$/,\n    exclude: /node_modules/,\n    use: [\n      {\n        loader: \"ts-loader\",\n        options: tsLoaderOptions\n      },\n    ],\n  })\n}"]}
